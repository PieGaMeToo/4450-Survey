<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Communication Study</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="mainHeader">
      AI Communication Study
    </div>
<div id="consentSection">
  <p>Please read and agree to participate in this study.</p>
  <div class="finePrint">

    <h4>PURPOSE OF STUDY</h4>

    <p>
    You are being asked to take part in a research study. Before you decide to participate in this study, it is important that you understand why the research is being done and what it will involve. Please read the following information carefully. Please reach out to the researcher if there is anything that is not clear or if you need more information at abr232@cornell.edu.
    </p>

    <p>
    The purpose of this study is to examine how multilingual students make real-world decisions about using tools such as Google Translate, Grammarly, or ChatGPT when writing emails to professors/TAs, Slack/Teams messages for group projects, discussion posts, and formal academic messages. Rather than testing translation quality or whether people can “detect AI,” we focus on decision-making and self-presentation: what situations feel “safe” for tool use, what feels risky, and how students manage identity, credibility, and tone in digital communication.
    </p>

    <h4>STUDY PROCEDURES</h4>

    <p>
    This study will be conducted in the form of an online survey. Participants will be expected to answer all mandatory questions to the best of their ability. Following this consent form, the study will proceed as follows:
    </p>

    <p>
    The participant will be presented with several demographic questions, which will only be used to categorize our results in a larger picture. These questions will not be used to identify, target, or otherwise endanger any specific participants.
    </p>

    <p>
    The participant will then be asked to respond to four scenarios created with the intention of simulating academic interactions. Within these scenarios, there are three main parts:
    </p>

    <p>
    A box in which the participant will be asked to type in their responses<br>
    A AI chatbot which the participant can choose to use to enhance, alter, or otherwise interact with the text they had written in the aforementioned text box<br>
    A few survey questions regarding the participant’s experience with the current scenario
    </p>

    <p>
    This study is expected to take 10 minutes in total, however this estimate depends on the amount that a participant chooses to engage with the material. Thus, the time required may vary.
    </p>

    <p>
    No taping, video recording, or similar form of recording will be used for this study.
    </p>

    <h4>RISKS</h4>

    <p>
    If at any point you feel that the survey causes any discomfort, you may terminate your involvement at any time if you choose.
    </p>

    <h4>BENEFITS</h4>

    <p>
    Primarily, since this survey is completed through SONA, appropriate credit will be given to the participant. As well, we hope that the information obtained from this survey will benefit the participant as they continue to utilize AI tools following the study.
    </p>

    <h4>CONFIDENTIALITY</h4>

    <p>
    Your responses to this survey will be anonymous beyond the allocation of reward through SONA. Please do not write any identifying information on your survey. Any and all information will be associated with a randomly assigned identification number per participant, and will only be used to gauge larger demographic information.
    </p>

    <p>
    Participant data will be kept confidential except in cases where the researcher is legally obligated to report specific incidents. These incidents include, but may not be limited to, incidents of abuse and suicide risk.
    </p>

    <h4>CONTACT INFORMATION</h4>

    <p>
    If you have questions at any time about this study, or you experience adverse effects as the result of participating in this study, you may contact the researcher whose contact information is provided on the first page. If you have questions regarding your rights as a research participant, or if problems arise which you do not feel you can discuss with the Primary Investigator, please contact the Institutional Review Board at (865) 354-3000, ext. 4822.
    </p>

    <h4>VOLUNTARY PARTICIPATION</h4>

    <p>
    Your participation in this study is voluntary. It is up to you to decide whether or not to take part in this study. If you decide to take part in this study, you will be asked to sign a consent form. After you sign the consent form, you are still free to withdraw at any time and without giving a reason. Withdrawing from this study will not affect the relationship you have, if any, with the researcher. If you withdraw from the study before data collection is completed, your data will be returned to you or destroyed.
    </p>

    <h4>CONSENT</h4>

    <p>
    I have read and I understand the provided information and have had the opportunity to ask questions. I understand that my participation is voluntary and that I am free to withdraw at any time, without giving a reason and without cost. I voluntarily agree to take part in this study.
    </p>

  </div>


  <button id="agreeBtn">I Agree</button>
</div>

<div id="demographicsSection" class="hidden section">
  <h3>Background Questions</h3>

  <label>Native language(s):</label>
  <input id="nativeLang"><br><br>

  <label>English proficiency (1–10):</label>
  <input type="number" id="englishProf" min="1" max="10"><br><br>

  <label>Years in English academic environment:</label>
  <input type="number" id="yearsUS"><br><br>

  <label>How often do you use AI writing tools? (1–10)</label>
  <input type="number" id="aiFreq" min="1" max="10"><br><br>

  <button id="submitDemo">Continue</button>
</div>

<div id="scenarioSection" class="hidden section">
  <h3 id="scenarioTitle"></h3>
  <p id="scenarioText"></p>

  <label>Write your draft below:</label>
  <textarea id="draftBox"></textarea>

  <div id="aiSection" class="section">
    <h4>AI Assistant (Optional)</h4>
    <div class="chat-box" id="chatBox"></div>
    <input id="aiInput" placeholder="Ask for feedback or revision help" style="width:80%">
    <button id="aiSend">Send</button>
  </div>

  <div class="section">
    <h4>Reflection</h4>

    <label>Did you use AI assistance?</label>
    <select id="usedAI">
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select><br><br>

    <label>How risky did this feel? (1–10)</label>
    <input type="number" id="risk" min="1" max="10"><br><br>

    <label>How authentic does this message feel to you? (1–10)</label>
    <input type="number" id="auth" min="1" max="10"><br><br>

    <button id="nextScenario">Next</button>
  </div>
</div>

<div id="finalSection" class="hidden section">
  <h3>Thank you!</h3>
  <p>You have completed the study.</p>
</div>

<script>
let aiUsedBehaviorally = false;
let participantId = localStorage.getItem("pid");

if (!participantId) {
  participantId = crypto.randomUUID();
  localStorage.setItem("pid", participantId);
}

let currentScenario = 0;

let scenarios = [
  { id: "prof_email", text: "Email your professor requesting a 2-day extension due to illness." },
  { id: "group_slack", text: "Send a Slack message explaining you cannot attend a group meeting." },
  { id: "discussion_post", text: "Write a discussion board response to a class reading." },
  { id: "formal_request", text: "Email a professor asking about joining their research lab." }
];

function showSection(id) {
  document.querySelectorAll("#consentSection, #demographicsSection, #scenarioSection, #finalSection")
    .forEach(d => d.classList.add("hidden"));

  document.getElementById(id).classList.remove("hidden");
}

document.getElementById("agreeBtn").onclick = () => {
  showSection("demographicsSection");
};

document.getElementById("submitDemo").onclick = async () => {
  await fetch("/demographics", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      participant_id: participantId,
      native_language: document.getElementById("nativeLang").value,
      english_proficiency: document.getElementById("englishProf").value,
      years_in_us: document.getElementById("yearsUS").value,
      ai_usage_frequency: document.getElementById("aiFreq").value
    })
  });

  loadScenario();
};

function loadScenario() {
  if (currentScenario >= scenarios.length) {
    showSection("finalSection");
    return;
  }

  const s = scenarios[currentScenario];
  document.getElementById("scenarioTitle").innerText = "Scenario " + (currentScenario + 1);
  document.getElementById("scenarioText").innerText = s.text;
  document.getElementById("draftBox").value = "";
  document.getElementById("chatBox").innerHTML = "";

  document.getElementById("usedAI").value = "no";
  document.getElementById("risk").value = "";
  document.getElementById("auth").value = "";

  showSection("scenarioSection");
}

document.getElementById("aiSend").onclick = async () => {
  const msg = document.getElementById("aiInput").value;
  if (!msg) return;

  aiUsedBehaviorally = true;

  const draftText = document.getElementById("draftBox").value;
  const chatBox = document.getElementById("chatBox");

  chatBox.innerHTML += "<div><b>You:</b> " + msg + "</div>";
  document.getElementById("aiInput").value = "";

  const response = await fetch("/chat", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      userId: participantId,
      message: msg,
      scenario: scenarios[currentScenario].text,
      draft: draftText
    })
  });

  const data = await response.json();

  if (data.reply) {
    document.getElementById("draftBox").value = data.reply;
    chatBox.innerHTML += "<div><b>AI:</b> " + data.reply + "</div>";
    chatBox.scrollTop = chatBox.scrollHeight;
  }
};

document.getElementById("nextScenario").onclick = async () => {

  const draftText = document.getElementById("draftBox").value.trim();
  const risk = document.getElementById("risk").value;
  const auth = document.getElementById("auth").value;

  if (!draftText) {
    alert("Please write a draft before continuing.");
    return;
  }

  if (!risk || !auth) {
    alert("Please complete all reflection questions.");
    return;
  }

  const scenarioId = scenarios[currentScenario].id;

  try {

    // Save draft FIRST (note this always happens)
    await fetch("/save-draft", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({
        participant_id: participantId,
        scenario: scenarioId,
        draft_text: draftText
      })
    });

    // Save reflection
    await fetch("/survey-response", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({
        participant_id: participantId,
        scenario: scenarioId,
        draft_text: draftText,
        used_ai_self_report: document.getElementById("usedAI").value,
        used_ai_behavioral: aiUsedBehaviorally,
        perceived_risk: risk,
        authenticity: auth
      })
    });

  } catch (err) {
    console.error("Save error:", err);
    alert("There was an error saving your response. Please try again.");
    return;
  }

  aiUsedBehaviorally = false;
  currentScenario++;
  loadScenario();
};

</script>

  </div>
</body>
</html>
